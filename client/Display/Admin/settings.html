<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Admin Settings</title>
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
  </head>
  <body>
    <form id="passwordUpdateForm" onsubmit="updatePassword(event)">
      <h2>Update Password</h2>
      <input
        type="password"
        id="newPassword"
        placeholder="New Password"
        required
      />
      <input
        type="password"
        id="confirmPassword"
        placeholder="Confirm Password"
        required
      />
      <button type="submit">Update Password</button>
    </form>

    <script>
      const API_URL = "http://localhost:3000/api";

      async function updatePassword(event) {
        event.preventDefault();

        const newPassword = document.getElementById("newPassword").value;
        const confirmPassword =
          document.getElementById("confirmPassword").value;

        if (newPassword !== confirmPassword) {
          alert("Passwords do not match");
          return;
        }

        try {
          const token =
            localStorage.getItem("authToken") ||
            sessionStorage.getItem("authToken");
          const response = await axios.put(
            `${API_URL}/admin/settings/update-password`,
            { newPassword },
            {
              headers: {
                Authorization: `Bearer ${token}`,
              },
            }
          );

          if (response.data.success) {
            alert("Password updated successfully");
            document.getElementById("passwordUpdateForm").reset();
          }
        } catch (error) {
          console.error("Password update error:", error);
          alert(error.response?.data?.message || "Failed to update password");
        }
      }

      // Check auth on page load
      function checkAuth() {
        const token =
          localStorage.getItem("authToken") ||
          sessionStorage.getItem("authToken");
        if (!token) {
          window.location.href = "../login/login.html";
        }
      }

      checkAuth();
    </script>
  </body>
</html>
