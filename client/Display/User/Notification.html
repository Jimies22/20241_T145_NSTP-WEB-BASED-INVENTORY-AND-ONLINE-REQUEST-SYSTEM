<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">

	<!-- Boxicons -->
	<link href='https://unpkg.com/boxicons@2.0.9/css/boxicons.min.css' rel='stylesheet'>
	<!-- My CSS -->
	<link rel="stylesheet" href="Notification.css">

	<!-- Add this line after your CSS links -->
	<script src="js/notifications.js"></script>

	<title>User</title>
</head>
<body>


	<!-- SIDEBAR -->
	<section id="sidebar">
		<a href="#" class="brand">
			<img src="img/NSTP_LOGO.png" alt="Admin Logo" class="brand" />
			<span class="text">User</span>
		</a>
		<ul class="side-menu top">
            <li>
				<a href="Dashboard.html">
					<i class='bx bxs-dashboard'></i>
					<span class="text">Dashboard</span>
				</a>
			</li>
			<li>
				<a href="Requestpage.html">
					<i class='bx bxs-shopping-bag-alt' ></i>
					<span class="text">Request</span>
				</a>
			</li>
            <li>
				<a href="Borroweditems.html">
					<i class='bx bxs-book'></i>
					<span class="text">Borrowed Items</span>
				</a>
			</li>
			<li>
				<a href="Reports.html">
                    <i class='bx bxs-report' ></i>
					<span class="text">Reports</span>
				</a>
			</li>
		</ul>
		<ul class="side-menu">
			<!-- <li>
				<a href="#">
					<i class='bx bxs-cog' ></i>
					<span class="text">Settings</span>
				</a>
			</li> -->
			<li>
				<a href="../login/login.html" class="logout">
					<i class='bx bxs-log-out-circle' ></i>
					<span class="text">Logout</span>
				</a>
			</li>
		</ul>
	</section>
	<!-- SIDEBAR -->



	<!-- CONTENT -->
	<section id="content">
		<!-- NAVBAR -->
		<nav>
			<i class='bx bx-menu' ></i>
			<a href="#" class="nav-link">Categories</a>
			<form action="#">
				<div class="form-input">
					<input type="search" placeholder="Search...">
					<button type="submit" class="search-btn"><i class='bx bx-search' ></i></button>
				</div>
			</form>
			<input type="checkbox" id="switch-mode" hidden>
			<label for="switch-mode" class="switch-mode"></label>
			<div class="notification-container">
				<a href="Notification.html" class="notification">
					<i class='bx bxs-bell'></i>
					<span class="badge" id="notification-count">0</span>
				</a>
				<div class="notification-dropdown" id="notification-dropdown">
					<!-- Notifications will be populated here -->
				</div>
			</div>
			<a href="StaffProfile.html" class="profile">
				<img src="img/Screen-Shot-2024-06-11-at-11.54.30-AM-e1718634535872.webp">
			</a>
		</nav>
		<!-- NAVBAR -->

		<!-- MAIN -->
		<main>
			<div class="head-title">
				<div class="left">
					<h1>Notifications</h1>
					<ul class="breadcrumb">
						<!-- ... existing breadcrumb ... -->
					</ul>
				</div>
				<div class="right" style="display: flex; align-items: center;">
					<button class="btn-download" onclick="markAllNotificationsAsRead()">
						<i class='bx bx-check-double'></i>
						<span class="text">Mark all as read</span>
					</button>
					<i class='bx bx-trash trash-icon' onclick="deleteAllNotifications()"></i>
				</div>
			</div>

			<div class="notification-list" id="notificationList">
				<!-- Notifications will be inserted here dynamically -->
			</div>
		</main>
		<!-- MAIN -->
	</section>
	<!-- CONTENT -->
	

	<script>
	document.addEventListener('DOMContentLoaded', function() {
		// Initialize notification count first
		const notifications = JSON.parse(localStorage.getItem('notifications')) || [];
		const notificationCounter = document.getElementById('notification-count');
		if (notificationCounter) {
			notificationCounter.textContent = notifications.filter(n => !n.read).length;
		}

		function createNotificationElement(notification, index) {
			const timeAgo = getTimeAgo(notification.timestamp);
			return `
				<div class="notification-item ${notification.read ? '' : 'unread'} ${notification.type}" data-index="${index}">
					<input type="checkbox" class="select-notification checkbox-spacing" data-index="${index}" onclick="toggleNotificationSelection(${index})">
					<div class="notification-icon">
						${getIconForType(notification.type)}
					</div>
					<div class="notification-content" onclick="toggleCheckboxAndMarkAsRead(${index})">
						<div class="notification-title">${notification.title}</div>
						<div class="notification-message">${notification.message}</div>
						<div class="notification-time">${timeAgo}</div>
					</div>
				</div>
			`;
		}

		function getIconForType(type) {
			const icons = {
				'booking': '<i class="bx bx-package"></i>',
				'accepted': '<i class="bx bx-check-double"></i>',
				'rejected': '<i class="bx bx-x"></i>',
				'cancel-request': '<i class="bx bx-block"></i>',
				'canceled': '<i class="bx bx-x-circle"></i>',
				'returned': '<i class="bx bx-check-circle"></i>'
			};
			return icons[type] || '<i class="bx bx-bell"></i>';
		}

		function getTimeAgo(timestamp) {
			const now = new Date();
			const past = new Date(timestamp);
			const diffInSeconds = Math.floor((now - past) / 1000);

			if (diffInSeconds < 60) {
				return 'Just now';
			} else if (diffInSeconds < 3600) {
				const minutes = Math.floor(diffInSeconds / 60);
				return `${minutes} minute${minutes > 1 ? 's' : ''} ago`;
			} else if (diffInSeconds < 86400) {
				const hours = Math.floor(diffInSeconds / 3600);
				return `${hours} hour${hours > 1 ? 's' : ''} ago`;
			} else {
				const days = Math.floor(diffInSeconds / 86400);
				return `${days} day${days > 1 ? 's' : ''} ago`;
			}
		}

		function displayNotifications() {
			const notificationList = document.getElementById('notificationList');
			if (notifications.length === 0) {
				notificationList.innerHTML = `
					<div class="no-notifications">
						<i class='bx bx-bell-off'></i>
						<p>No notifications yet</p>
					</div>
				`;
			} else {
				notificationList.innerHTML = notifications
					.map((notification, index) => createNotificationElement(notification, index))
					.join('');
			}
			updateNotificationCount();
		}

		function updateNotificationCount() {
			const unreadCount = notifications.filter(n => !n.read).length;
			if (notificationCounter) {
				notificationCounter.textContent = unreadCount;
			}
		}

		window.markAllNotificationsAsRead = function() {
			notifications.forEach(notification => notification.read = true);
			localStorage.setItem('notifications', JSON.stringify(notifications));
			displayNotifications();
			updateNotificationCount();
		};

		window.markNotificationAsRead = function(index) {
			const notification = notifications[index];
			if (!notification.read) {
				notification.read = true; // Mark as read
				localStorage.setItem('notifications', JSON.stringify(notifications));
				displayNotifications();
				updateNotificationCount();
			}
		};

		window.toggleNotificationSelection = function(index) {
			const checkbox = document.querySelector(`.select-notification[data-index="${index}"]`);
			if (checkbox) {
				const notificationItem = checkbox.closest('.notification-item');
				if (checkbox.checked) {
						notificationItem.classList.add('selected');
				} else {
						notificationItem.classList.remove('selected');
				}
			}
		};

		window.deleteAllNotifications = function() {
			const selectedNotifications = document.querySelectorAll('.notification-item.selected');
			const indicesToDelete = Array.from(selectedNotifications).map(item => parseInt(item.getAttribute('data-index')));
			indicesToDelete.sort((a, b) => b - a); // Sort in descending order to avoid index shifting issues

			indicesToDelete.forEach(index => {
				notifications.splice(index, 1); // Remove the notification
			});
			localStorage.setItem('notifications', JSON.stringify(notifications));
			displayNotifications();
			updateNotificationCount();
		};

		window.toggleCheckboxAndMarkAsRead = function(index) {
			const checkbox = document.querySelector(`.select-notification[data-index="${index}"]`);
			if (checkbox) {
				checkbox.checked = !checkbox.checked;
				toggleNotificationSelection(index);
			}
			markNotificationAsRead(index);
		};

		displayNotifications();
	});
	</script>
</body>
</html>